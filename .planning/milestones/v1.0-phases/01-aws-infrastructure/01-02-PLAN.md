---
phase: 01-aws-infrastructure
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - docs/analyst-aws-setup.md
autonomous: true

must_haves:
  truths:
    - "An analyst can configure their AWS credentials by following the documentation"
    - "An analyst can verify their S3 access works from DuckDB, R, or Python"
    - "The documentation covers both ~/.aws/credentials and ~/.aws/config with exact syntax"
  artefacts:
    - path: "docs/analyst-aws-setup.md"
      provides: "Step-by-step analyst credential configuration guide"
      contains: "aws_access_key_id"
  key_links:
    - from: "docs/analyst-aws-setup.md"
      to: "scripts/verify_s3_access.sql"
      via: "reference to verification script"
      pattern: "verify_s3_access"
---

<objective>
Create documentation that guides analysts through configuring AWS credentials and verifying S3 access from DuckDB, R, and Python.

Purpose: Requirement INFRA-02. Without this, analysts cannot configure their machines to access the shared data, blocking all downstream data consumption.
Output: A single markdown guide at `docs/analyst-aws-setup.md`.
</objective>

<execution_context>
@C:\Users\steve.crawshaw\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\steve.crawshaw\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-aws-infrastructure/01-CONTEXT.md
@.planning/phases/01-aws-infrastructure/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create analyst AWS credential setup guide</name>
  <files>docs/analyst-aws-setup.md</files>
  <action>
    Create `docs/analyst-aws-setup.md` with the following sections:

    **Title:** AWS Credential Setup for DuckLake Analysts

    **Prerequisites section:**
    - You have received an AWS access key ID and secret access key from the data owner (via Keeper).
    - You have DuckDB installed (for SQL access), and/or R with the `pins` package, and/or Python with `boto3`.
    - No AWS CLI installation required (but useful for troubleshooting).

    **Step 1: Create credentials file**
    - Path: `~/.aws/credentials` (Linux/Mac) or `C:\Users\USERNAME\.aws\credentials` (Windows).
    - Show exact file content with `[default]` profile containing `aws_access_key_id` and `aws_secret_access_key` placeholders.
    - Note: create the `.aws` directory if it does not exist.

    **Step 2: Create config file**
    - Path: `~/.aws/config` (Linux/Mac) or `C:\Users\USERNAME\.aws\config` (Windows).
    - Show exact file content: `[default]` profile with `region = eu-west-2` and `output = json`.
    - Emphasise: region MUST be `eu-west-2` (London) -- the bucket is in this region.

    **Step 3: Verify access**
    Three verification methods (analyst picks whichever tool they use):

    a) **DuckDB** -- reference `scripts/verify_s3_access.sql` from the repository. Show the SQL inline as well:
    ```sql
    INSTALL aws; LOAD aws;
    CREATE OR REPLACE SECRET ducklake_s3 (TYPE s3, PROVIDER credential_chain, CHAIN config, REGION 'eu-west-2');
    SELECT * FROM glob('s3://stevecrawshaw-bucket/*');
    ```
    Expected: a list of files in the bucket.

    b) **R (pins)** -- show board_s3 setup:
    ```r
    library(pins)
    board <- board_s3(bucket = "stevecrawshaw-bucket", region = "eu-west-2")
    pin_list(board)
    ```
    Expected: a character vector of pin names (may be empty if no pins published yet).

    c) **Python (boto3)** -- show S3 list:
    ```python
    import boto3
    s3 = boto3.client("s3", region_name="eu-west-2")
    response = s3.list_objects_v2(Bucket="stevecrawshaw-bucket", MaxKeys=5)
    for obj in response.get("Contents", []):
        print(obj["Key"])
    ```
    Expected: file keys printed.

    d) **AWS CLI (optional)** -- if they have it installed:
    ```bash
    aws s3 ls s3://stevecrawshaw-bucket/
    ```

    **Troubleshooting section:**
    - "Access Denied" on list but get works: check that the IAM policy has `s3:ListBucket` on the bucket ARN (not the object ARN). Contact the data owner.
    - Region errors / 301 redirects: verify `region = eu-west-2` in `~/.aws/config`. In DuckDB, always use explicit `REGION 'eu-west-2'`.
    - "No credentials" error: check file paths and profile name. The `[default]` profile is used unless otherwise specified.
    - Credentials vs config file confusion: credentials file uses `[profile-name]`, config file uses `[profile profile-name]` (with prefix). For the default profile, both use `[default]`.

    **Style notes:**
    - Use British English throughout.
    - Keep it concise -- analysts are technical, not beginners.
    - Use code blocks for all file contents and commands.
    - Use placeholder format `<YOUR_ACCESS_KEY_ID>` and `<YOUR_SECRET_ACCESS_KEY>` for credential values.
  </action>
  <verify>
    - File exists at `docs/analyst-aws-setup.md`.
    - File contains all four verification methods (DuckDB, R, Python, AWS CLI).
    - File contains both `~/.aws/credentials` and `~/.aws/config` templates.
    - File contains troubleshooting section.
    - File uses `eu-west-2` throughout (not `us-east-1` or other regions).
    - No hardcoded credentials appear in the file.
  </verify>
  <done>
    Analyst-facing documentation exists covering credential setup, three verification methods, and common troubleshooting scenarios. An analyst with access keys can follow the guide and verify S3 access independently.
  </done>
</task>

</tasks>

<verification>
1. `docs/analyst-aws-setup.md` exists and is well-structured markdown.
2. All verification code blocks use `eu-west-2` region explicitly.
3. No actual credentials or account IDs appear in the documentation.
4. Both Windows and Linux/Mac file paths are shown for credential files.
5. Troubleshooting covers the pitfalls identified in RESEARCH.md (ARN format, region mismatch, file confusion).
</verification>

<success_criteria>
- INFRA-02 met: documentation exists for analysts to configure AWS credentials.
- An analyst receiving access keys via Keeper can follow the guide end-to-end.
- Guide covers DuckDB, R, and Python verification paths.
</success_criteria>

<output>
After completion, create `.planning/phases/01-aws-infrastructure/01-02-SUMMARY.md`
</output>
